<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Sociograma — SOCIOMAP</title>
<script src="https://d3js.org/d3.v7.min.js"></script>

<style>
body{
  margin:0;
  padding:32px;
  background:linear-gradient(180deg,#0f172a,#0b1222);
  font-family:"Segoe UI",Arial,sans-serif;
  color:white;
  text-align:center;
}
h1{margin-bottom:6px;}
.sub{color:#cbd5e1;margin-bottom:24px;}

#card{
  max-width:1200px;
  margin:auto;
  background:white;
  border-radius:16px;
  padding:20px;
  box-shadow:0 8px 30px rgba(0,0,0,.35);
}

svg{
  width:100%;
  height:720px;
  border-radius:12px;
  border:2px dashed #e2e8f0;
  background:white;
}

.legend{
  display:flex;
  justify-content:center;
  gap:24px;
  margin-top:14px;
  font-size:14px;
  color:#0f172a;
  flex-wrap:wrap;
}
.legend span{display:flex;align-items:center;gap:6px;}
.dot{width:14px;height:14px;border-radius:50%;}

footer{
  margin-top:20px;
  font-size:14px;
  color:#0f172a;
}
footer img{
  height:46px;
  display:block;
  margin:0 auto 6px;
}

.error{
  color:#b91c1c;
  font-size:18px;
  padding:40px;
}
</style>
</head>

<body>

<h1>Sociograma Interactivo Académico</h1>
<div class="sub" id="info"></div>

<div id="card">
  <div id="graph"></div>

  <div class="legend">
    <span><div class="dot" style="background:#22c55e"></div> Relación positiva</span>
    <span><div class="dot" style="background:#ef4444"></div> Relación negativa</span>
    <span><div class="dot" style="background:#facc15"></div> Líder sociométrico</span>
    <span><div class="dot" style="background:#60a5fa"></div> Tamaño ∝ votos recibidos</span>
  </div>

  <footer>
    <img src="logo.png" alt="SOCIOMAP">
    SOCIOMAP · by Aranda Tools · 2026
  </footer>
</div>

<script>
const labels = JSON.parse(sessionStorage.getItem("socio_labels")||"null");
const matrix = JSON.parse(sessionStorage.getItem("socio_matrix")||"null");
const grupo = sessionStorage.getItem("socio_grupo")||"";

if(!labels||!matrix){
  document.getElementById("graph").innerHTML =
    `<div class="error">No hay datos sociométricos válidos.</div>`;
  throw "Sin datos";
}

const fecha = new Date().toLocaleDateString("es-ES",
  {day:"numeric",month:"long",year:"numeric"});
document.getElementById("info").textContent =
  `Grupo: ${grupo||"Sin nombre"} — ${fecha}`;

const nodes = labels.map((name,i)=>{
  let pos=0;
  matrix.forEach(r=>{ if(r[i]==="+")pos++; });
  return {id:i,name,pos};
});

const leader = nodes.reduce((a,b)=>b.pos>a.pos?b:a);

const links=[];
matrix.forEach((r,i)=>{
  r.forEach((v,j)=>{
    if(v==="+"||v==="-")links.push({s:i,t:j,v});
  });
});

const w=document.getElementById("card").clientWidth;
const h=720;

const svg=d3.select("#graph").append("svg")
  .attr("viewBox",`0 0 ${w} ${h}`);

const sim=d3.forceSimulation(nodes)
  .force("link",d3.forceLink(links)
    .id(d=>d.id)
    .distance(150))
  .force("charge",d3.forceManyBody().strength(-420))
  .force("center",d3.forceCenter(w/2,h/2));

const link=svg.append("g")
  .selectAll("line")
  .data(links).enter().append("line")
  .attr("stroke",d=>d.v==="+"?"#22c55e":"#ef4444")
  .attr("stroke-width",2)
  .attr("stroke-dasharray",d=>d.v==="-"?"6,4":"0");

const node=svg.append("g")
  .selectAll("g")
  .data(nodes).enter().append("g")
  .call(d3.drag()
    .on("start",e=>!e.active&&sim.alphaTarget(.3).restart())
    .on("drag",(e,d)=>{d.fx=e.x;d.fy=e.y})
    .on("end",(e,d)=>{d.fx=d.fy=null}));

node.append("circle")
  .attr("r",d=>26+d.pos*3)
  .attr("fill",d=>d.id===leader.id?"#facc15":"#60a5fa")
  .attr("stroke","#334155")
  .attr("stroke-width",2);

node.append("text")
  .text(d=>d.name)
  .attr("dy",".35em")
  .attr("text-anchor","middle")
  .attr("font-size","13px")
  .attr("font-weight","bold")
  .attr("fill","#0f172a");

sim.on("tick",()=>{
  link
    .attr("x1",d=>d.source.x)
    .attr("y1",d=>d.source.y)
    .attr("x2",d=>d.target.x)
    .attr("y2",d=>d.target.y);
  node.attr("transform",d=>`translate(${d.x},${d.y})`);
});
</script>

</body>
</html>




