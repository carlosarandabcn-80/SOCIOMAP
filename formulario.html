<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Formulario SociomÃ©trico â€” SOCIOMAP</title>

  <!-- LIBRERÃAS -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <style>
    body {
      background: #0f172a;
      color: #e2e8f0;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      text-align: center;
    }

    .container {
      max-width: 1000px;
      margin: auto;
      background: rgba(255, 255, 255, 0.05);
      padding: 28px;
      border-radius: 14px;
    }

    img.logo {
      height: 64px;
      background: white;
      border-radius: 12px;
      padding: 4px 12px;
      margin-bottom: 18px;
    }

    h1 { margin-bottom: 6px; }
    p { margin-top: 0; color: #cbd5e1; }

    label { display: block; margin-top: 12px; font-weight: bold; }

    input, select {
      width: 100%;
      padding: 8px;
      margin: 6px 0;
      border-radius: 8px;
      font-size: 14px;
      box-sizing: border-box;
    }

    .checkbox-row {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      margin-top: 12px;
    }

    .btn {
      padding: 8px 14px;
      border-radius: 8px;
      border: none;
      background: #e2e8f0;
      color: #0f172a;
      font-weight: bold;
      cursor: pointer;
      font-size: 14px;
    }

    .btn-primary {
      background: #3b82f6;
      color: white;
      margin-top: 12px;
    }

    .btn-primary:hover { background: #2563eb; }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      border: 1px solid #475569;
      padding: 6px;
      text-align: center;
    }

    th { background: #1e293b; }

    .checkOK { color: #22c55e; font-weight: bold; }

    .ranking-box, .grafico-box {
      margin-top: 24px;
      background: white;
      color: black;
      border-radius: 12px;
      padding: 16px;
      display: none;
    }

    .export-row {
      display: none;
      justify-content: center;
      gap: 12px;
      margin-top: 18px;
      flex-wrap: wrap;
    }

    .export-row .btn {
      font-size: 13px;
      padding: 7px 14px;
    }

    footer {
      margin-top: 18px;
      color: #94a3b8;
      font-size: 14px;
    }
  </style>
</head>
<body>

<div class="container">
  <img src="logo.png" class="logo" alt="SOCIOMAP">
  <h1>Formulario SociomÃ©trico</h1>
  <p>Introduce la tabla sociomÃ©trica (3 elecciones + y 3 rechazos âˆ’ por persona).</p>

  <label>Nombre del grupo</label>
  <input id="grupo" type="text" placeholder="Ej.: Taller A1">

  <label>NÃºmero de participantes</label>
  <select id="num"></select>

  <div class="checkbox-row">
    <input type="checkbox" id="custom">
    <label for="custom" style="margin:0;">Usar nombres personalizados</label>
  </div>

  <input id="names" type="text" placeholder="Ana, Juan, LucÃ­a..." style="display:none;margin-top:8px;">

  <button class="btn btn-primary" onclick="crearTabla()">Crear tabla</button>

  <div id="tabla"></div>

  <div id="rankingControl" style="margin-top:18px;display:none;">
    <button class="btn btn-primary" onclick="procesar()">Crear ranking</button>
  </div>

  <p id="infoText" style="font-size:13px;color:#94a3b8;margin-top:10px;">
    Completa correctamente la tabla sociomÃ©trica para generar el ranking
  </p>

  <div id="ranking" class="ranking-box"></div>

  <div class="grafico-box" id="graficoBox">
    <h3>ðŸ“Š GrÃ¡fico de barras sociomÃ©trico (interactivo)</h3>
    <canvas id="chart"></canvas>
    <p style="font-size:13px;color:#64748b;">Pasa el cursor sobre las barras para explorar valores.</p>
  </div>

  <div class="export-row" id="exportBtns">
    <button class="btn" onclick="exportar('tablaVotos','tabla_sociometrica')">Exportar tabla</button>
    <button class="btn" onclick="exportar('ranking','ranking_roles')">Exportar ranking</button>
    <button class="btn" onclick="exportarCanvas()">Exportar grÃ¡fico</button>
  </div>

  <button onclick="window.location.href='Sociograma_web.html'"
    class="btn btn-primary"
    style="margin-top:24px;font-size:16px;padding:12px 22px;border-radius:10px;">
    âž• Crear Sociograma
  </button>

  <footer>Â© SOCIOMAP Â· Aranda Tools Â· 2026</footer>
</div>

<script>
const num = document.getElementById("num");
for (let i = 7; i <= 40; i++) num.innerHTML += `<option>${i}</option>`;

document.getElementById("custom").onchange = e => {
  document.getElementById("names").style.display = e.target.checked ? "block" : "none";
};

function crearTabla() {
  const n = +num.value;
  const custom = document.getElementById("custom").checked;

  let names = custom
    ? document.getElementById("names").value.split(",").map(x => x.trim())
    : Array.from({ length: n }, (_, i) => "P" + (i + 1));

  if (names.length !== n) {
    alert("NÃºmero de nombres incorrecto");
    return;
  }

  let html = `<table id="tablaVotos"><thead><tr><th>De\\A</th>`;
  names.forEach(x => html += `<th>${x}</th>`);
  html += `<th>âœ”</th></tr></thead><tbody>`;

  names.forEach((r, i) => {
    html += `<tr><th>${r}</th>`;
    names.forEach((_, j) => {
      html += i === j ? `<td></td>` : `<td><select class="cell">
        <option>0</option><option>+</option><option>-</option></select></td>`;
    });
    html += `<td class="checkOK" id="c${i}"></td></tr>`;
  });

  html += `</tbody></table>`;
  document.getElementById("tabla").innerHTML = html;

  document.querySelectorAll(".cell").forEach(c => c.onchange = validar);

  document.getElementById("rankingControl").style.display = "none";
  document.getElementById("ranking").style.display = "none";
  document.getElementById("graficoBox").style.display = "none";
  document.getElementById("exportBtns").style.display = "none";
  document.getElementById("infoText").style.display = "block";
}

function validar() {
  let ok = true;
  document.querySelectorAll("#tablaVotos tbody tr").forEach((tr, i) => {
    let p = 0, n = 0;
    tr.querySelectorAll("select").forEach(s => {
      if (s.value === "+") p++;
      if (s.value === "-") n++;
    });
    document.getElementById("c" + i).textContent = (p === 3 && n === 3) ? "âœ”" : "";
    if (p !== 3 || n !== 3) ok = false;
  });

  document.getElementById("rankingControl").style.display = ok ? "block" : "none";
  document.getElementById("infoText").style.display = ok ? "none" : "block";
}

function determinarRol(p, n) {
  if (p > 3 && n <= 1) return "LÃ­der";
  if (n > 3) return "Rechazado";
  if (p === 0) return "Aislado";
  if (p >= 2 && n >= 2) return "Ambivalente";
  if (p >= 2 && n <= 1) return "Integrado";
  return "Sin rol";
}

function procesar() {
  const labels = [...document.querySelectorAll("#tablaVotos thead th")]
    .slice(1, -1).map(th => th.textContent);
  const stats = Object.fromEntries(labels.map(l => [l, { p: 0, n: 0 }]));

  document.querySelectorAll(".cell").forEach((c, i) => {
    const j = i % labels.length;
    if (c.value === "+") stats[labels[j]].p++;
    if (c.value === "-") stats[labels[j]].n++;
  });

  const res = labels.map(l => {
    const p = stats[l].p, n = stats[l].n;
    return { l, p, n, rol: determinarRol(p, n) };
  }).sort((a, b) => b.p - a.p);

  let html = `<h3>Ranking y roles sociomÃ©tricos</h3>
  <table><tr><th>Nombre</th><th>+</th><th>-</th><th>Rol</th></tr>`;
  res.forEach(r => {
    html += `<tr><td>${r.l}</td><td>${r.p}</td><td>${r.n}</td><td>${r.rol}</td></tr>`;
  });
  html += `</table>`;

  document.getElementById("ranking").innerHTML = html;
  document.getElementById("ranking").style.display = "block";

  crearGrafico(res);
  document.getElementById("exportBtns").style.display = "flex";

  // Save for sociograma
  const matrix = [];
  document.querySelectorAll("#tablaVotos tbody tr").forEach(tr => {
    const row = [];
    tr.querySelectorAll("select").forEach(s => row.push(s.value));
    matrix.push(row);
  });

  sessionStorage.setItem("socio_labels", JSON.stringify(labels));
  sessionStorage.setItem("socio_matrix", JSON.stringify(matrix));
  sessionStorage.setItem("socio_grupo", document.getElementById("grupo").value.trim());
}

let chart;
function crearGrafico(res) {
  if (chart) chart.destroy();
  document.getElementById("graficoBox").style.display = "block";

  chart = new Chart(document.getElementById("chart"), {
    type: "bar",
    data: {
      labels: res.map(r => r.l),
      datasets: [
        { label: "Votos +", data: res.map(r => r.p), backgroundColor: "#22c55e" },
        { label: "Votos -", data: res.map(r => -r.n), backgroundColor: "#ef4444" }
      ]
    }
  });
}

function exportar(id, name) {
  html2canvas(document.getElementById(id)).then(c => {
    const a = document.createElement("a");
    a.href = c.toDataURL();
    a.download = name + ".png";
    a.click();
  });
}

function exportarCanvas() {
  const a = document.createElement("a");
  a.href = document.getElementById("chart").toDataURL();
  a.download = "grafico_sociometrico.png";
  a.click();
}
</script>

</body>
</html>





