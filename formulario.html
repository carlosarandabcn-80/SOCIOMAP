<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Formulario Sociom√©trico ‚Äî SOCIOMAP</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  margin: 0;
  padding: 20px;
  background: #0f172a;
  color: #e2e8f0;
  font-family: "Segoe UI", Arial, sans-serif;
  text-align: center;
}

.container {
  max-width: 1000px;
  margin: auto;
  background: rgba(255,255,255,.05);
  padding: 26px;
  border-radius: 14px;
}

h1 { margin-bottom: 6px }
p { margin-top: 0; color: #cbd5e1 }

label { display:block; margin-top:12px }

input, select {
  width:100%;
  padding:8px;
  margin-top:6px;
  border-radius:8px;
  font-size:14px;
  box-sizing:border-box;
}

.checkbox-row {
  display:flex;
  justify-content:center;
  align-items:center;
  gap:8px;
  margin-top:12px;
}

.btn {
  padding:9px 16px;
  border-radius:8px;
  border:none;
  font-weight:bold;
  cursor:pointer;
  margin-top:14px;
}

.btn-primary {
  background:#3b82f6;
  color:white;
}

.btn-primary:hover:enabled {
  background:#2563eb;
}

.btn-disabled {
  background:#475569;
  cursor:not-allowed;
  opacity:.6;
}

table {
  width:100%;
  border-collapse:collapse;
  margin-top:20px;
}

th, td {
  border:1px solid #475569;
  padding:6px;
  text-align:center;
}

th {
  background:#1e293b;
  color:white;
}

.check-ok {
  color:#22c55e;
  font-weight:bold;
}

/* RESULTADOS */
.ranking-box {
  display:none;
  background:white;
  color:black;
  border-radius:12px;
  padding:16px;
  margin-top:24px;
}

/* GR√ÅFICO */
.grafico-box {
  display:none;
  background:white;
  color:black;
  border-radius:12px;
  padding:16px;
  margin:24px auto 0;
  max-width:800px;
  height:420px;
  position:relative;
}
.grafico-box canvas {
  position:absolute;
  inset:60px 16px 16px 16px;
}

/* Roles */
.role-lider { background:#dcfce7 }
.role-rechazado { background:#fee2e2 }
.role-aislado { background:#e5e7eb }
.role-ambivalente { background:#fef9c3 }
.role-integrado { background:#dbeafe }

#btnSociograma {
  display:none;
}

.logo {
  height:64px;
  margin:24px auto 0;
  display:block;
}

footer {
  margin-top:10px;
  color:#94a3b8;
  font-size:14px;
}
</style>
</head>

<body>
<div class="container">

<h1>Formulario Sociom√©trico</h1>
<p>Completa la tabla con + / ‚àí / 0. Cada fila debe tener exactamente 3 + y 3 ‚àí.</p>

<label>Nombre del grupo</label>
<input id="grupo" placeholder="Ej.: 3¬∫A, Equipo Verde">

<label>N√∫mero de participantes</label>
<select id="num">
  <option value="">-- Elige --</option>
</select>

<div class="checkbox-row">
  <input type="checkbox" id="custom">
  <label for="custom">Usar nombres personalizados</label>
</div>

<input id="names" placeholder="Ana, Juan, Luc√≠a..." style="display:none">

<button class="btn btn-primary" onclick="crearTabla()">Crear tabla</button>
<button id="btnRanking" class="btn btn-primary btn-disabled" disabled onclick="procesar()">Crear ranking</button>

<div id="tabla"></div>
<div id="ranking" class="ranking-box"></div>

<div id="graficoBox" class="grafico-box">
  <h3>üìä Gr√°fico Sociom√©trico</h3>
  <canvas id="chart"></canvas>
</div>

<button id="btnSociograma" class="btn btn-primary" onclick="irASociograma()">CREAR SOCIOGRAMA</button>

<img src="logo.png" class="logo">
<footer>¬© SOCIOMAP ¬∑ ARANDA TOOLS 2026</footer>

</div>

<script>
const grupo = document.getElementById("grupo");
const custom = document.getElementById("custom");
const names = document.getElementById("names");
const numSelect = document.getElementById("num");
const tablaDiv = document.getElementById("tabla");
const rankingDiv = document.getElementById("ranking");
const graficoBox = document.getElementById("graficoBox");
const btnRanking = document.getElementById("btnRanking");
const btnSociograma = document.getElementById("btnSociograma");
const chartCanvas = document.getElementById("chart");

let chart = null;

for (let i = 7; i <= 40; i++) {
  numSelect.innerHTML += `<option value="${i}">${i}</option>`;
}

custom.onchange = () =>
  names.style.display = custom.checked ? "block" : "none";

function crearTabla() {
  const n = +numSelect.value;
  const grupoNombre = grupo.value.trim();
  if (!n || !grupoNombre) return alert("Completa los datos");

  let nombres = custom.checked
    ? names.value.split(",").map(x => x.trim())
    : Array.from({ length: n }, (_, i) => "P" + (i + 1));

  if (nombres.length !== n) {
    alert("La cantidad de nombres no coincide");
    return;
  }

  let html = `<table id="tablaVotos"><thead><tr><th>De\\A</th>`;
  nombres.forEach(n => html += `<th>${n}</th>`);
  html += `<th>‚úî</th></tr></thead><tbody>`;

  nombres.forEach((from, i) => {
    html += `<tr><th>${from}</th>`;
    nombres.forEach((_, j) => {
      html += i === j
        ? "<td></td>"
        : `<td><select class="cell"><option>0</option><option>+</option><option>-</option></select></td>`;
    });
    html += `<td id="check${i}" class="check-ok"></td></tr>`;
  });

  tablaDiv.innerHTML = html + "</tbody></table>";
  document.querySelectorAll(".cell").forEach(c => c.onchange = validar);
}

function validar() {
  let ok = true;
  document.querySelectorAll("#tablaVotos tbody tr").forEach((tr, i) => {
    let p = 0, n = 0;
    tr.querySelectorAll("select").forEach(s => {
      if (s.value === "+") p++;
      if (s.value === "-") n++;
    });
    document.getElementById("check" + i).textContent = (p === 3 && n === 3) ? "‚úî" : "";
    if (p !== 3 || n !== 3) ok = false;
  });
  btnRanking.disabled = !ok;
  btnRanking.classList.toggle("btn-disabled", !ok);
}

function procesar() {
  const headers = [...document.querySelectorAll("#tablaVotos thead th")]
    .slice(1, -1).map(th => th.textContent);

  let pos = Array(headers.length).fill(0);
  let neg = Array(headers.length).fill(0);

  document.querySelectorAll(".cell").forEach((c, i) => {
    const j = i % headers.length;
    if (c.value === "+") pos[j]++;
    if (c.value === "-") neg[j]++;
  });

  rankingDiv.innerHTML = `<table><tr><th>Nombre</th><th>+</th><th>-</th><th>Rol</th></tr>` +
    headers.map((name, i) => {
      const p = pos[i], n = neg[i];
      const rol = calcularRol(p, n);
      return `<tr class="role-${rol.toLowerCase()}">
        <td>${name}</td><td>${p}</td><td>${n}</td><td>${rol}</td></tr>`;
    }).join("") + `</table>`;

  rankingDiv.style.display = "block";
  graficoBox.style.display = "block";

  if (chart) chart.destroy();

  chart = new Chart(chartCanvas, {
    type: "bar",
    data: {
      labels: headers,
      datasets: [
        { label: "Votos +", data: pos, backgroundColor: "#22c55e" },
        { label: "Votos -", data: neg, backgroundColor: "#ef4444" }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
    }
  });

  btnSociograma.style.display = "inline-block";
}

function calcularRol(p, n) {
  if (p > 3 && n <= 1) return "Lider";
  if (n > 3) return "Rechazado";
  if (p === 0) return "Aislado";
  if (p >= 2 && n >= 2) return "Ambivalente";
  return "Integrado";
}

function irASociograma() {
  location.href = "sociograma_interactivo.html";
}
</script>

</body>
</html>
