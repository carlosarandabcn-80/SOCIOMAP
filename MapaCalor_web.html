<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mapa de Calor SociomÃ©trico</title>

  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background: #0f172a;
      color: #0f172a;
      text-align: center;
    }

    .container {
      max-width: 1200px;
      margin: 40px auto;
      padding: 20px;
      background: #ffffff;
      border-radius: 14px;
    }

    h1 {
      margin-bottom: 4px;
    }

    p {
      margin-top: 0;
      color: #475569;
      font-size: 14px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      table-layout: fixed;
    }

    th, td {
      border: 1px solid #e2e8f0;
      padding: 6px;
      text-align: center;
      font-size: 13px;
    }

    th {
      background: #f1f5f9;
      color: #0f172a;
      position: sticky;
      top: 0;
      z-index: 2;
    }

    .heat-pos {
      background: #bbf7d0; /* verde */
      font-weight: bold;
    }

    .heat-neg {
      background: #fecaca; /* rojo */
      font-weight: bold;
    }

    .heat-zero {
      background: #f8fafc; /* neutro */
      color: #94a3b8;
    }

    .diag {
      background: #e2e8f0;
    }

    .legend {
      display: flex;
      justify-content: center;
      gap: 24px;
      margin-top: 16px;
      flex-wrap: wrap;
      font-size: 14px;
    }

    .legend span {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .legend i {
      width: 14px;
      height: 14px;
      border-radius: 4px;
      display: inline-block;
    }

    .btn {
      margin-top: 24px;
      padding: 12px 22px;
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: bold;
      cursor: pointer;
    }

    .btn:hover {
      background: #2563eb;
    }

    footer {
      margin-top: 24px;
      font-size: 13px;
      color: #64748b;
    }
  </style>
</head>

<body>

<div class="container">
  <h1>Mapa de Calor SociomÃ©trico</h1>
  <p>Relaciones sociomÃ©tricas (emisor â†’ receptor)</p>

  <div id="heatmap"></div>

  <div class="legend">
    <span><i style="background:#bbf7d0;"></i> RelaciÃ³n positiva (+)</span>
    <span><i style="background:#fecaca;"></i> RelaciÃ³n negativa (âˆ’)</span>
    <span><i style="background:#f8fafc; border:1px solid #94a3b8;"></i> Sin relaciÃ³n</span>
  </div>

  <button class="btn" onclick="window.location.href='Sociograma_web.html'">
    ðŸ”™ Volver al Sociograma
  </button>

  <footer>Â© SOCIOMAP Â· Aranda Tools Â· 2026</footer>
</div>

<script>
/* =========================
   CARGA DE DATOS
========================= */

const data = JSON.parse(localStorage.getItem("sociogramaData"));

if (!data || !data.nodes || !data.links) {
  document.getElementById("heatmap").innerHTML =
    "<p style='color:red;font-weight:bold;'>No hay datos sociomÃ©tricos. Vuelve al formulario.</p>";
  throw new Error("Datos no encontrados");
}

/* =========================
   NOMBRES Y MATRIZ
========================= */

const names = data.nodes.map(n => n.name);
const size = names.length;

// Crear matriz NxN inicializada a "0"
const matrix = Array.from({ length: size }, () =>
  Array.from({ length: size }, () => "0")
);

/* =========================
   RELLENAR MATRIZ (ROBUSTO)
========================= */

data.links.forEach(link => {
  const sourceName =
    typeof link.source === "string" ? link.source : link.source.name;
  const targetName =
    typeof link.target === "string" ? link.target : link.target.name;

  const i = names.indexOf(sourceName);
  const j = names.indexOf(targetName);

  if (i !== -1 && j !== -1) {
    matrix[i][j] = link.type;
  }
});

/* =========================
   CONSTRUIR TABLA HTML
========================= */

let html = "<table><thead><tr><th>De \\ A</th>";

names.forEach(name => {
  html += `<th>${name}</th>`;
});

html += "</tr></thead><tbody>";

matrix.forEach((row, i) => {
  html += `<tr><th>${names[i]}</th>`;
  row.forEach((val, j) => {
    if (i === j) {
      html += `<td class="diag"></td>`;
    } else if (val === "+") {
      html += `<td class="heat-pos">+</td>`;
    } else if (val === "-") {
      html += `<td class="heat-neg">âˆ’</td>`;
    } else {
      html += `<td class="heat-zero">0</td>`;
    }
  });
  html += "</tr>";
});

html += "</tbody></table>";

document.getElementById("heatmap").innerHTML = html;
</script>

</body>
</html>

